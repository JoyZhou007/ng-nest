<div class="nm-table-inner" [class.nm-table-has-group]="nmGroupQuery.group">
  <div class="nm-table-group" *ngIf="nmGroupQuery.group">
    <nm-table
      [nmColumns]="nmGroupColumns"
      [nmQuery]="nmGroupQuery"
      [nmService]="nmService"
      [nmTableHeaderHidden]="true"
      [nmTableFooterHidden]="true"
      [nmAllowSelectRow]="true"
      [nmRowPrimary]="nmGroupQuery.group"
      [nmActivatedRow]="nmGroupActivatedRow"
      [nmSearchPlaceholder]="nmGroupSearchPlaceholder"
      (nmRowClick)="groupRowClick($event)"
    ></nm-table>
  </div>
  <div class="nm-table-struct">
    <div class="nm-table-tool">
      <div class="nm-table-tool-left" *ngIf="topLeftActions.length > 0">
        <ng-container
          *ngTemplateOutlet="nmButtonsTpl; context: { space: 1, actions: topLeftActions }"
        ></ng-container>
      </div>
      <div class="nm-table-tool-right">
        <nm-input
          [nmIcon]="'fto-search'"
          [nmPlaceholder]="nmSearchPlaceholder"
          [nmIconLayout]="'left'"
        ></nm-input>
        <ng-container *ngIf="topRightIconActions.length > 0">
          <ng-container
            *ngTemplateOutlet="nmButtonsTpl; context: { actions: topRightIconActions }"
          ></ng-container>
        </ng-container>
      </div>
    </div>
    <div class="nm-table-header" *ngIf="!nmTableHeaderHidden">
      <ul>
        <ng-container *ngFor="let column of nmColumns">
          <li [style.width.rem]="column.nmWidth" [style.flex]="column.nmFlex">
            <span>{{ column.nmLabel }}</span>
          </li>
        </ng-container>
      </ul>
    </div>
    <div class="nm-table-body">
      <ul
        *ngFor="let item of data"
        [class.nm-table-row-activated]="
          nmAllowSelectRow && nmActivatedRow && nmActivatedRow[nmRowPrimary] === item[nmRowPrimary]
        "
        (click)="rowClick(item, $event)"
      >
        <ng-container *ngFor="let column of nmColumns; index as i">
          <li
            [style.width.rem]="column.nmWidth"
            [style.flex]="column.nmFlex"
            [title]="item[column.nmKey]"
          >
            <div [innerHTML]="item[column.nmKey]"></div>
            <ng-container *ngIf="!i && rowIconActions.length > 0">
              <ng-container
                *ngTemplateOutlet="
                  nmButtonsTpl;
                  context: { actions: rowIconActions, notBorder: true }
                "
              ></ng-container>
            </ng-container>
          </li>
        </ng-container>
      </ul>
    </div>
    <div class="nm-table-footer" *ngIf="!nmTableFooterHidden">
      <nm-pagination
        [nmIndex]="nmIndex"
        [nmSize]="nmSize"
        [nmTotal]="nmTotal"
        (nmIndexChange)="change($event)"
      ></nm-pagination>
    </div>
  </div>
</div>

<ng-template #nmButtonsTpl let-space="space" let-notBorder="notBorder" let-actions="actions">
  <nm-buttons [nmSpace]="space" [nmNotBorder]="notBorder">
    <nm-button
      *ngFor="let action of actions"
      [nmLabel]="action.nmLabel"
      [nmIcon]="action.nmIcon"
      [nmTitle]="action.nmTitle"
      [nmActivated]="action.nmActivated"
      (click)="actionClick(action, $event)"
    ></nm-button>
  </nm-buttons>
</ng-template>
